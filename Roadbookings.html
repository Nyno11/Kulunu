<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Road Trip Results</title>

  <!-- Favicons -->
  <link href="assets/img/ku.png" rel="icon">
  <link href="assets/img/ku.png" rel="apple-touch-icon">

  <!-- Existing CSS -->
  <link href="assets/css/Result.css" rel="stylesheet">
</head>
<body>

<header>
  <div>Road Trip Results</div>
  <a href="Authentication.html">‚Üê Back</a>
</header>

<!-- FILTER BAR -->
<div class="filter-bar">
  <div class="filter-option active" data-filter="price">Cheapest</div>
  <div class="filter-option" data-filter="rating">Rating</div>
  <div class="filter-option" data-filter="time">Time</div>
  <div class="indicator"></div>
</div>

<!-- RESULTS -->
<div class="results" id="results"></div>

<script>
/* ===============================
   ROAD TRANSPORT DATA
================================ */
const trips = [
  {
    company: 'GUO Transport',
    from: 'Abuja',
    to: 'Lagos',
    time: '7:00 AM',
    price: 35000,
    rating: 4.5,                                                
    logo:'assets/img/guo-transport-logo-png.png'
  },
  {
    company: 'God Is Good Motors',
    from: 'Abuja',
    to: 'Lagos',
    time: '5:30 AM',
    price: 30000,
    rating: 4.2,
    logo: 'assets/img/GIGM.png'
  },
  {
    company: 'ABC Transport',
    from: 'Abuja',
    to: 'Lagos',
    time: '6:30 PM',
    price: 28000,
    rating: 3.9,
    logo: 'assets/img/ABC-LOGISTICS-LOGO.png' 
  }
];

const indicator = document.querySelector('.indicator');
const options = document.querySelectorAll('.filter-option');
const results = document.getElementById('results');

/* ===============================
   RENDER TRIPS
================================ */
function renderTrips(data) {
  results.innerHTML = '';

  data.forEach(trip => {
    const div = document.createElement('div');
    div.className = 'ticket';

    div.innerHTML = `
      <div class="airline-header">
        <img src="${trip.logo}" alt="${trip.company}" class="airline-logo">
        <h3>${trip.company}</h3>
      </div>

      <p><strong>From:</strong> ${trip.from}</p>
      <p><strong>To:</strong> ${trip.to}</p>

      <div class="flight-info-row">
        <p>üïí <strong>Departure:</strong> ${trip.time}</p>
        <p>üí∞ <strong>Price:</strong> ‚Ç¶${trip.price.toLocaleString()}</p>
        <p>‚≠ê <strong>Rating:</strong> ${trip.rating}</p>
      </div>

      <button class="buy-button" onclick='bookTrip(${JSON.stringify(trip)})'>
        Book Trip
      </button>
    `;

    results.appendChild(div);
  });
}

/* ===============================
   FILTER INDICATOR
================================ */
function moveIndicator(target) {
  indicator.style.width = `${target.offsetWidth}px`;
  indicator.style.left = `${target.offsetLeft}px`;
}

/* ===============================
   FILTER LOGIC
================================ */
options.forEach(option => {
  option.addEventListener('click', () => {
    options.forEach(opt => opt.classList.remove('active'));
    option.classList.add('active');
    moveIndicator(option);

    const criteria = option.dataset.filter;
    const sorted = [...trips];

    if (criteria === 'price') sorted.sort((a, b) => a.price - b.price);
    if (criteria === 'rating') sorted.sort((a, b) => b.rating - a.rating);
    if (criteria === 'time') {
      sorted.sort(
        (a, b) =>
          new Date(`1970/01/01 ${a.time}`) -
          new Date(`1970/01/01 ${b.time}`)
      );
    }

    renderTrips(sorted);
  });
});

/* ===============================
   INITIAL LOAD
================================ */
window.onload = () => {
  moveIndicator(document.querySelector('.filter-option.active'));
  renderTrips(trips);
};
</script>

<script>
/* ===============================
   BOOK TRIP
================================ */
function bookTrip(trip) {
  const primary = JSON.parse(localStorage.getItem("primaryTraveler"));
  const coTravelers = JSON.parse(localStorage.getItem("coTravelers")) || [];

  let passengers = [];

  if (primary) {
    passengers.push({
      name: `${primary.firstName} ${primary.lastName}`,
      type: primary.travelerType
    });
  }

  coTravelers.forEach(c => {
    passengers.push({
      name: `${c.firstName} ${c.lastName}`,
      type: c.travelerType
    });
  });

  const bookingData = {
    travelInfo: {
      from: trip.from,
      to: trip.to,
      date: new Date().toISOString().split("T")[0],
      time: trip.time,
      vehicle: trip.vehicle,
      company: trip.company,
      price: trip.price
    },
    passengers
  };

  localStorage.setItem("bookingData", JSON.stringify(bookingData));
  window.location.href = "Roadtrip.html";
}
</script>

</body>
</html>
