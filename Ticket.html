<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Kulunu Ticketing</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/ku.png" rel="icon">
  <link href="assets/img/ku.png" rel="apple-touch-icon">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet" />
     <!-- Main CSS File -->
  <link href="assets/css/Ticket.css" rel="stylesheet"> 
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

</head>
    <!-- MAIN SECTIONS -->
<header>
    <div class="header-left">
        <i class="ri-user-3-fill profile-icon"></i>
        <div class="user-info">
            <small class="user-name">Nonso Chukwu</small>
            <small class="user-email">nonso@kulunu.com</small>
        </div>
    </div>

    <div class="header-right">
        <i class="ri-notification-3-line notif-icon"></i>
    </div>
</header>

 <!-- Home page -->
<div id="homePage" class="page-section active-section">
    <section class="hero">
        <div class="search-box">
            <input type="text" placeholder="Search events..." />
            <button><i class="ri-search-line"></i></button>
        </div>
        <!-- HERO: Trending Events Carousel -->
<section class="hero-carousel">
  <div class="carousel-container">
    <div class="carousel-track">

      <!-- Slide 1 -->
      <div class="carousel-slide">
        <img src="assets/img/trend1.jpg" alt="Trending Event 1">
        <div class="carousel-caption">
          <h3>GRAND OPENING</h3>
          <p>Experience Soundgod festival live.</p>
        </div>
      </div>

      <!-- Slide 2 -->
      <div class="carousel-slide">
        <img src="assets/img/trend2.jpg" alt="Trending Event 2">
        <div class="carousel-caption">
          <h3>OBI's HOUSE</h3>
          <p>Party, music & unforgettable memories.</p>
        </div>
      </div>

      <!-- Slide 3 -->
      <div class="carousel-slide">
        <img src="assets/img/trend3.jpg" alt="Trending Event 3">
        <div class="carousel-caption">
          <h3>ABUJA TECH CONVERGE</h3>
          <p>Innovation meets opportunity.</p>
        </div>
      </div>

      <!-- ✅ Slide 4 (Moved INSIDE carousel-track) -->
      <div class="carousel-slide">
        <img src="assets/img/trend4.jpg" alt="Trending Event 4">
        <div class="carousel-caption">
          <h3>THE CAVEMEN</h3>
          <p>Explore the cave with The Cavemen and Staycavy.</p>
        </div>
      </div>

    </div>

    <!-- Dots Navigation -->
    <div class="carousel-dots"></div>

  </div>
</section>
    </section>


<section class="categories-section">
    <h2>Categories</h2>

    <div class="categories-scroll">

        <div class="category-item" onclick="goTo('Concert.html')">
            <i class="ri-music-2-fill"></i>
            <span>Concerts</span>
        </div>
        

        <div class="category-item" onclick="goTo('Sports.html')">
            <i class="ri-football-fill"></i>
            <span>Sports</span>
        </div>

        <div class="category-item" onclick="goTo('Comedy.html')">
            <i class="ri-mic-fill"></i>
            <span>Comedy</span>
        </div>

        <div class="category-item" onclick="goTo('Movies.html')">
            <i class="ri-movie-2-fill"></i>
            <span>Movies</span>
        </div>

        <div class="category-item" onclick="goTo('Festivals.html')">
            <i class="ri-map-pin-fill"></i>
            <span>Festivals</span>
        </div>

        <div class="category-item" onclick="goTo('Tech.html')">
            <i class="ri-computer-fill"></i>
            <span>Tech</span>
        </div>

        <div class="category-item" onclick="goTo('Coummunity.html')">
            <i class="ri-community-fill"></i>
            <span>Community</span>
        </div>

        <div class="category-item" onclick="goTo('Education.html')">
            <i class="ri-graduation-cap-fill"></i>
            <span>Education</span>
        </div>

    </div>
</section>

    <section class="featured">
        <div class="featured-header">
        <h2>Just Added</h2>
        <span class="see-all">See All</span>
          </div>
        <div class="event-scroll">
            <div class="event-card">
                <img src="assets/img/trend4.jpg" />
                <h3>THE CAVEMEN</h3>
          <p>Explore the cave with The Cavemen and Staycavy.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend3.jpg" />
                <h3>ABUJA TECH CONVERGE</h3>
          <p>Innovation meets opportunity.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend2.jpg" />
                <h3>OBI's HOUSE</h3>
          <p>Party, music & unforgettable memories.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend1.jpg" />
                 <h3>GRAND OPENING</h3>
          <p>Experience Soundgod festival live.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend5.jpg" />
                <h3>CAPITAL MACHINE</h3>
          <p>Capital Block Party.</p>
            </div>
        </div>
    </section>

    <section class="featured">
        <div class="featured-header">
        <h2>Upcoming Events</h2>
        <span class="see-all">See All</span>
          </div>
        <div class="event-scroll">
            <div class="event-card">
                <img src="assets/img/trend4.jpg" />
                <h3>THE CAVEMEN</h3>
          <p>Explore the cave with The Cavemen and Staycavy.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend3.jpg" />
                <h3>ABUJA TECH CONVERGE</h3>
          <p>Innovation meets opportunity.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend2.jpg" />
                <h3>OBI's HOUSE</h3>
          <p>Party, music & unforgettable memories.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend1.jpg" />
                 <h3>GRAND OPENING</h3>
          <p>Experience Soundgod festival live.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend5.jpg" />
                <h3>CAPITAL MACHINE</h3>
          <p>Capital Block Party.</p>
            </div>
        </div>
    </section>

<section class="featured">
        <div class="featured-header">
        <h2>Parties</h2>
        <span class="see-all">See All</span>
          </div>
        <div class="event-scroll">
            <div class="event-card">
                <img src="assets/img/trend4.jpg" />
                <h3>THE CAVEMEN</h3>
          <p>Explore the cave with The Cavemen and Staycavy.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend5.jpg" />
                <h3>CAPITAL MACHINE</h3>
          <p>Capital Block Party.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend2.jpg" />
                <h3>OBI's HOUSE</h3>
          <p>Party, music & unforgettable memories.</p>
            </div>

            <div class="event-card">
                <img src="assets/img/trend1.jpg" />
                 <h3>GRAND OPENING</h3>
          <p>Experience Soundgod festival live.</p>
            </div>
        </div>
    </section>
</div>

<!-- Scan page -->
<div id="scanPage" class="page-section">
    <div class="page">
    <h2 style="text-align:center;">Scan QR Code</h2>
    <div id="qr-reader" style="width:100%; max-width:400px; margin: 20px auto;"></div>
    <p id="qr-result" style="text-align:center; font-weight:500; color:#0c7cff;">
      To swiftly pay for tickets, each experience features its own QR code. You can scan it instantly using your device.
    </p>
    <button id="stop-scan-btn" class="btn" style="margin: 20px auto; display:block;">
      Stop Scan
    </button>

    <!-- Overlay warning -->
    <div id="camera-warning" class="overlay">
      <div class="modal">
        <h4>Camera Access Needed</h4>
        <p>
          We need camera permission to scan QR codes. Please allow camera access in your browser settings.
        </p>
        <button id="close-warning-btn" class="btn">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Wallet page -->
<div id="walletPage" class="page-section">
<div class="page">

  <!-- wallet card -->
  <div class="wallet-card" role="region" aria-label="Wallet balance">
    <div class="wallet-top">
      <div>
        <div class="wallet-label">Available Balance</div>
        <div class="wallet-balance" id="balance">₦ <span id="balanceValue">0</span></div>
        <div class="wallet-id" id="walletId">Wallet ID: 234-882-557</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
        <button class="btn" id="openAdd">Add Money</button>
        <button class="btn ghost" id="openWithdraw" style="margin-top:4px">Withdraw</button>
      </div>
    </div>

    <!-- quick actions -->
    <div class="actions" style="margin-top:12px">
      <div class="action-btn" id="gotoTransactions" title="Transactions">
        <i class="ri-file-list-3-line"></i>
        <span>Transactions</span>
      </div>
      <div class="action-btn" id="openLinkCard" title="Link card">
        <i class="ri-credit-card-2-line"></i>
        <span>Link Card</span>
      </div>
      <div class="action-btn" id="openSettings" title="Settings">
        <i class="ri-settings-3-line"></i>
        <span>Settings</span>
      </div>
    </div>
  </div>

  <!-- transactions section header -->
  <div class="section-head">
    <h3>Recent Transactions</h3>
    <div class="small-link" id="viewAllTx">View all</div>
  </div>

  <!-- recent tx list -->
  <div class="tx-list" id="txList">
    <!-- JS will inject items -->
  </div>

  <!-- linked cards & settings preview -->
  <div style="margin-top:18px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Linked Cards</h3>
      <div class="small-link" id="manageCards">Manage</div>
    </div>
    <div class="cards-grid" id="cardsGrid">
      <!-- JS inject -->
    </div>
  </div>

</div>

<!-- Modals / overlays -->
<!-- Add Money -->
<div class="overlay" id="overlayAdd">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addTitle">
    <div style="position:relative">
      <div class="close-x" id="closeAdd">&times;</div>
      <h4 id="addTitle">Add Money</h4>
      <p style="color:var(--muted);font-size:13px;margin-bottom:8px">Top up your Kulunu wallet using card or external payment</p>

      <div class="field">
        <label>Amount (₦)</label>
        <input type="number" id="addAmount" class="input" placeholder="Enter amount" min="100" value="5000">
      </div>

      <div class="field">
        <label>Payment method</label>
        <select id="addMethod" class="input">
          <option value="card">Card (Visa/Mastercard/Verve)</option>
          <option value="googlepay">Google Pay</option>
          <option value="bank">Bank Transfer</option>
        </select>
      </div>

      <div style="display:flex;gap:10px;margin-top:10px">
        <button class="btn" id="confirmAdd">Continue</button>
        <button class="btn ghost" id="cancelAdd">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Withdraw -->
<div class="overlay" id="overlayWithdraw">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="withdrawTitle">
    <div style="position:relative">
      <div class="close-x" id="closeWithdraw">&times;</div>
      <h4 id="withdrawTitle">Withdraw</h4>
      <p style="color:var(--muted);font-size:13px;margin-bottom:8px">Move funds from your Kulunu wallet to your bank.</p>

      <div class="field">
        <label>Amount (₦)</label>
        <input type="number" id="withdrawAmount" class="input" placeholder="Enter amount" min="100" value="2000">
      </div>

      <div class="field">
        <label>Bank account</label>
        <input type="text" id="withdrawAccount" class="input" placeholder="Account number — Bank name">
      </div>

      <div style="display:flex;gap:10px;margin-top:10px">
        <button class="btn" id="confirmWithdraw">Request Withdraw</button>
        <button class="btn ghost" id="cancelWithdraw">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Link Card Modal -->
<div class="overlay" id="overlayCard">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cardTitle">
    <div style="position:relative">
      <div class="close-x" id="closeCard">&times;</div>
      <h4 id="cardTitle">Link Card</h4>
      <p style="color:var(--muted);font-size:13px;margin-bottom:8px">Securely add your card for fast checkout.</p>

      <div class="field">
        <label>Card type</label>
        <select id="cardType" class="input">
          <option value="visa">Visa</option>
          <option value="mastercard">Mastercard</option>
          <option value="verve">Verve</option>
        </select>
      </div>

      <div class="field">
        <label>Card number</label>
        <input id="cardNumber" class="input" placeholder="4242 4242 4242 4242">
      </div>

      <div class="row" style="margin-top:6px">
        <div style="flex:1">
          <label>Expiry</label>
          <input id="cardExpiry" class="input" placeholder="MM/YY">
        </div>
        <div style="width:110px">
          <label>CVV</label>
          <input id="cardCvv" class="input" placeholder="123">
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-top:12px">
        <button class="btn" id="saveCard">Save Card</button>
        <button class="btn ghost" id="cancelCard">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Settings modal -->
<div class="overlay" id="overlaySettings">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div style="position:relative">
      <div class="close-x" id="closeSettings">&times;</div>
      <h4 id="settingsTitle">Wallet Settings</h4>
      <p style="color:var(--muted);font-size:13px;margin-bottom:8px">Manage notifications and auto-topup rules.</p>

      <div style="margin-top:10px">
        <label style="display:flex;justify-content:space-between;align-items:center">
          <span>Push notifications</span>
          <input type="checkbox" id="toggleNotif">
        </label>
        <div style="height:10px"></div>
        <label style="display:flex;justify-content:space-between;align-items:center">
          <span>Auto top-up when balance &lt; ₦1000</span>
          <input type="checkbox" id="toggleAuto">
        </label>
      </div>

      <div style="display:flex;gap:10px;margin-top:14px">
        <button class="btn" id="saveSettings">Save</button>
        <button class="btn ghost" id="cancelSettings">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Notifications placeholder -->
<div class="overlay" id="overlayNotifs">
  <div class="modal" style="max-width:420px">
    <div class="close-x" id="closeNotifs">&times;</div>
    <h4>Notifications</h4>
    <p style="color:var(--muted);font-size:13px;margin-bottom:8px">Recent alerts</p>
    <div style="display:flex;flex-direction:column;gap:8px">
      <div style="background:#fff;padding:12px;border-radius:10px">Your top-up (₦5,000) was successful — Jul 22</div>
      <div style="background:#fff;padding:12px;border-radius:10px">Ticket refunded — Jul 14</div>
    </div>
  </div>
</div>

<!-- Transactions full page -->
<div class="page-full" id="pageTransactions" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>All Transactions</h2>
    <div class="badge" id="txCount">0</div>
  </div>
  <div style="margin-top:10px">
    <div style="margin-bottom:12px">
      <input type="search" id="txFilter" class="input" placeholder="Search transactions (merchant / amount)"/>
    </div>
    <div id="txAllList" style="display:flex;flex-direction:column;gap:12px"></div>
  </div>
</div>

<script>
/* ---------------------------
   Simple in-memory demo store
   Replace api.* with real endpoints
   --------------------------- */
const store = {
  balance: 52800.00,
  tx: [
    {id:1,type:'debit',title:'Event Ticket',meta:'Lagos Music Fest',date:'2025-07-28',amount:20000},
    {id:2,type:'credit',title:'Top-up',meta:'Card ****4242',date:'2025-07-22',amount:50000},
    {id:3,type:'credit',title:'Cashback',meta:'Flight promo',date:'2025-07-18',amount:2800},
  ],
  cards: [
    {id:1,type:'visa',mask:'**** 4242',expiry:'12/26'}
  ],
  settings: {notif:true,autoTop:false},
  user: {name:'Nonso Chukwu',email:'nonso@kulunu.com'}
};

/* ---------------------------
   API stubs (replace these)
   --------------------------- */
const api = {
  getBalance: async ()=> {
    // replace with fetch('/api/wallet/balance')...
    return {ok:true, data: store.balance};
  },
  getTx: async ()=> ({ok:true, data: store.tx}),
  addMoney: async (amount, method)=> {
    // pretend success: push tx & update balance
    const id = Date.now();
    store.tx.unshift({id,type:'credit',title:'Wallet Top-up',meta:method,date:new Date().toISOString().slice(0,10),amount:Number(amount)});
    store.balance = Number(store.balance) + Number(amount);
    return {ok:true};
  },
  withdraw: async (amount, account)=> {
    const id = Date.now();
    store.tx.unshift({id,type:'debit',title:'Withdraw',meta:account,date:new Date().toISOString().slice(0,10),amount:Number(amount)});
    store.balance = Number(store.balance) - Number(amount);
    return {ok:true};
  },
  saveCard: async (card)=> {
    store.cards.push({...card, id:Date.now()});
    return {ok:true};
  },
  saveSettings: async (s)=> { store.settings = s; return {ok:true};}
};

/* ---------------------------
   UI helpers
   --------------------------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function formatN(value){
  return Number(value).toLocaleString(undefined,{maximumFractionDigits:0});
}

/* balance count-up animation */
async function loadBalance(){
  const res = await api.getBalance();
  if(!res.ok) return;
  const target = Number(res.data);
  const el = document.getElementById('balanceValue');
  let start = 0;
  const duration = 800;
  const step = (timestamp)=>{
    const progress = Math.min(1,(Date.now()-t0)/duration);
    const current = Math.floor(start + (target-start)*progress);
    el.textContent = formatN(current);
    if(progress<1) requestAnimationFrame(step);
    else el.textContent = formatN(target);
  };
  const t0 = Date.now();
  requestAnimationFrame(step);
}

/* render recent transactions */
async function renderRecent(){
  const res = await api.getTx();
  if(!res.ok) return;
  const list = res.data.slice(0,5);
  const txList = $('#txList');
  txList.innerHTML = '';
  list.forEach(tx=>{
    const item = document.createElement('div');
    item.className='tx-item';
    item.innerHTML = `
      <div class="tx-left">
        <div class="tx-icon">${ tx.type==='credit' ? '<i class="ri-add-line"></i>' : '<i class="ri-arrow-down-line"></i>' }</div>
        <div class="tx-info">
          <strong>${tx.title}</strong>
          <div class="tx-meta">${tx.meta} • ${tx.date}</div>
        </div>
      </div>
      <div class="tx-amount ${tx.type==='credit'?'credit':'debit'}">${tx.type==='credit'?'+ ':'- '}₦${formatN(tx.amount)}</div>
    `;
    txList.appendChild(item);
  });
}

/* render all transactions page */
async function renderAllTransactions(){
  const res = await api.getTx();
  const target = $('#txAllList');
  const countBadge = $('#txCount');
  target.innerHTML = '';
  if(!res.ok) return;
  const all = res.data;
  countBadge.textContent = all.length;
  all.forEach(tx=>{
    const el = document.createElement('div');
    el.className='tx-item';
    el.innerHTML = `
      <div class="tx-left">
        <div class="tx-icon">${ tx.type==='credit' ? '<i class="ri-add-line"></i>' : '<i class="ri-arrow-down-line"></i>' }</div>
        <div class="tx-info">
          <strong>${tx.title}</strong>
          <small class="tx-meta">${tx.meta} • ${tx.date}</small>
        </div>
      </div>
      <div class="tx-amount ${tx.type==='credit'?'credit':'debit'}">₦${formatN(tx.amount)}</div>
    `;
    target.appendChild(el);
  });
}

/* render cards */
function renderCards(){
  const target = $('#cardsGrid');
  target.innerHTML = '';
  store.cards.forEach(c=>{
    const el = document.createElement('div');
    el.className='card-item';
    el.innerHTML = `<strong>${c.type.toUpperCase()}</strong><small>${c.mask}</small><small>Exp ${c.expiry}</small>`;
    target.appendChild(el);
  });
}

/* ---------------------------
   Modal open/close wiring
   --------------------------- */
function openOverlay(id){ document.getElementById(id).style.display='flex'; }
function closeOverlay(id){ document.getElementById(id).style.display='none'; }

$('#openAdd').addEventListener('click',()=> openOverlay('overlayAdd'));
$('#closeAdd').addEventListener('click',()=> closeOverlay('overlayAdd'));
$('#cancelAdd').addEventListener('click',()=> closeOverlay('overlayAdd'));

$('#openWithdraw').addEventListener('click',()=> openOverlay('overlayWithdraw'));
$('#closeWithdraw').addEventListener('click',()=> closeOverlay('overlayWithdraw'));
$('#cancelWithdraw').addEventListener('click',()=> closeOverlay('overlayWithdraw'));

$('#openLinkCard').addEventListener('click',()=> openOverlay('overlayCard'));
$('#closeCard').addEventListener('click',()=> closeOverlay('overlayCard'));
$('#cancelCard').addEventListener('click',()=> closeOverlay('overlayCard'));

$('#openSettings').addEventListener('click',()=> {
  $('#toggleNotif').checked = store.settings.notif;
  $('#toggleAuto').checked = store.settings.autoTop;
  openOverlay('overlaySettings');
});
$('#closeSettings').addEventListener('click',()=> closeOverlay('overlaySettings'));
$('#cancelSettings').addEventListener('click',()=> closeOverlay('overlaySettings'));

$('#openNotifications').addEventListener('click',()=> openOverlay('overlayNotifs'));
$('#closeNotifs').addEventListener('click',()=> closeOverlay('overlayNotifs'));

$('#gotoTransactions').addEventListener('click', ()=> {
  document.getElementById('pageTransactions').style.display='block';
  renderAllTransactions();
});
$('#viewAllTx').addEventListener('click', ()=> {
  document.getElementById('pageTransactions').style.display='block';
  renderAllTransactions();
});

/* pageTransactions close by clicking outside (or ESC) */
document.getElementById('pageTransactions').addEventListener('click', (e)=>{
  if(e.target === document.getElementById('pageTransactions')) document.getElementById('pageTransactions').style.display='none';
});
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') {
  ['overlayAdd','overlayWithdraw','overlayCard','overlaySettings','overlayNotifs'].forEach(id=>closeOverlay(id));
  document.getElementById('pageTransactions').style.display='none';
}});

/* confirm add money */
$('#confirmAdd').addEventListener('click', async ()=>{
  const amount = Number($('#addAmount').value);
  const method = $('#addMethod').value;
  if(!amount || amount < 100){ alert('Enter an amount >= ₦100'); return; }
  $('#confirmAdd').textContent='Processing...'; $('#confirmAdd').disabled=true;
  const res = await api.addMoney(amount, method);
  if(res.ok){
    await loadBalance(); renderRecent(); renderCards();
    alert('Top-up successful');
    closeOverlay('overlayAdd');
  } else alert('Top-up failed');
  $('#confirmAdd').textContent='Continue'; $('#confirmAdd').disabled=false;
});

/* confirm withdraw */
$('#confirmWithdraw').addEventListener('click', async ()=>{
  const amount = Number($('#withdrawAmount').value);
  const account = $('#withdrawAccount').value.trim();
  if(!amount || amount<=0 || amount > store.balance){ alert('Invalid amount'); return;}
  if(!account){ alert('Provide bank account details'); return;}
  $('#confirmWithdraw').textContent='Processing...'; $('#confirmWithdraw').disabled=true;
  const res = await api.withdraw(amount, account);
  if(res.ok){ await loadBalance(); renderRecent(); renderAllTransactions(); alert('Withdraw requested'); closeOverlay('overlayWithdraw'); }
  else alert('Failed');
  $('#confirmWithdraw').textContent='Request Withdraw'; $('#confirmWithdraw').disabled=false;
});

/* save card */
$('#saveCard').addEventListener('click', async ()=>{
  const card = {type:$('#cardType').value, mask:'**** '+($('#cardNumber').value.slice(-4)||'0000'), expiry:$('#cardExpiry').value};
  $('#saveCard').textContent='Saving...'; $('#saveCard').disabled=true;
  const res = await api.saveCard(card);
  if(res.ok){ renderCards(); alert('Card linked'); closeOverlay('overlayCard'); }
  else alert('Failed to link');
  $('#saveCard').textContent='Save Card'; $('#saveCard').disabled=false;
});

/* save settings */
$('#saveSettings').addEventListener('click', async ()=>{
  const s = {notif:$('#toggleNotif').checked, autoTop:$('#toggleAuto').checked};
  $('#saveSettings').textContent='Saving...'; $('#saveSettings').disabled=true;
  const res = await api.saveSettings(s);
  if(res.ok){ alert('Settings saved'); closeOverlay('overlaySettings'); }
  else alert('Failed');
  $('#saveSettings').textContent='Save'; $('#saveSettings').disabled=false;
});

/* transactions search filter on full page */
$('#txFilter').addEventListener('input', ()=>{
  const q = $('#txFilter').value.toLowerCase();
  const target = $('#txAllList');
  target.childNodes.forEach(node=>{
    const text = node.textContent.toLowerCase();
    node.style.display = text.includes(q) ? '' : 'none';
  });
});

/* initial render */
(async function init(){
  // populate UI with store data (or fetch user profile)
  $('#uiName').textContent = store.user.name;
  $('#uiEmail').textContent = store.user.email;

  await loadBalance();
  await renderRecent();
  renderCards();

  // click outside modal to close
  $$('.overlay').forEach(o=>{
    o.addEventListener('click', (e)=> { if(e.target === o) o.style.display='none'; });
  });
})();
</script>
</div>

<div id="menuPage" class="page-section">
  <div class="menu-page">
    <div class="menu-grid">

      <div class="menu-card" onclick="goTo('tickets.html')">
        <div class="icon">
          <i class="bi bi-ticket-perforated"></i>
        </div>
        <div class="text">
          <h4>My Ticketry</h4>
          <p>View your tickets history</p>
        </div>
      </div>

      <div class="menu-card" onclick="goTo('Event.html')">
        <div class="icon">
          <i class="bi bi-calendar-event"></i>
        </div>
        <div class="text">
          <h4>Manage Event</h4>
          <p>Create & distribute tickets</p>
        </div>
      </div>

      <div class="menu-card" onclick="goTo('settings.html')">
        <div class="icon">
          <i class="bi bi-gear"></i>
        </div>
        <div class="text">
          <h4>Settings</h4>
          <p>Preferences & security</p>
        </div>
      </div>

      <div class="menu-card" onclick="goTo('terms.html')">
        <div class="icon">
          <i class="bi bi-file-earmark-text"></i>
        </div>
        <div class="text">
          <h4>Terms & Conditions</h4>
          <p>Legal information</p>
        </div>
      </div>

      <div class="menu-card logout" onclick="logout()">
        <div class="icon">
          <i class="bi bi-box-arrow-right"></i>
        </div>
        <div class="text">
          <h4>Log Out</h4>
          <p>Sign out of your account</p>
        </div>
      </div>

    </div>
  </div>
</div>


<!-- DOCK NAVIGATION -->
<div class="dock">
    <div class="dock-item active" data-target="homePage">
        <i class="ri-home-5-line"></i>
        Home
    </div>

    <div class="dock-item" data-target="scanPage">
        <i class="ri-qr-scan-2-line"></i>
        Scan
    </div>

    <div class="dock-item" data-target="walletPage">
        <i class="ri-wallet-3-line"></i>
        Wallet
    </div>

    <div class="dock-item" data-target="menuPage">
        <i class="ri-menu-3-line"></i>
        Menu
    </div>
</div>
<script>
document.querySelectorAll('.dock-item').forEach(item => {
    item.addEventListener('click', () => {

        // Remove active state from all dock items
        document.querySelectorAll('.dock-item')
                .forEach(i => i.classList.remove('active'));

        // Add active state to clicked item
        item.classList.add('active');

        // Hide all sections
        document.querySelectorAll('.page-section')
                .forEach(section => section.classList.remove('active-section'));

        // Show selected page
        const targetPage = item.getAttribute('data-target');
        document.getElementById(targetPage).classList.add('active-section');
    });
});

let html5QrCode = null;

function startQrScanner() {
    const qrReaderDiv = document.getElementById('qr-reader');
    if (html5QrCode) return; // already running

    html5QrCode = new Html5Qrcode("qr-reader");

    html5QrCode.start(
        { facingMode: "environment" }, // back camera
        { fps: 10, qrbox: 250 },
        (decodedText) => {
            document.getElementById('qr-result').innerText = `Scanned: ${decodedText}`;
        },
        (errorMessage) => {
            // show overlay if permission denied
            if (errorMessage.toLowerCase().includes("permission") || errorMessage.toLowerCase().includes("denied")) {
                showCameraWarning();
                stopQrScanner();
            }
        }
    ).catch(err => {
        console.error("Failed to start QR scanner:", err);
        showCameraWarning();
    });
}

function stopQrScanner() {
    if (html5QrCode) {
        html5QrCode.stop().then(() => {
            html5QrCode.clear();
            html5QrCode = null;
            document.getElementById('qr-result').innerText = "Scan stopped.";
        }).catch(err => console.error(err));
    }
}

function showCameraWarning() {
    document.getElementById('camera-warning').style.display = "flex";
}

function hideCameraWarning() {
    document.getElementById('camera-warning').style.display = "none";
}

// Dock navigation: start/stop scanner based on page
document.querySelectorAll('.dock-item').forEach(item => {
    item.addEventListener('click', () => {
        const targetPage = item.getAttribute('data-target');

        if (targetPage !== 'scanPage') stopQrScanner();
        if (targetPage === 'scanPage') startQrScanner();
    });
});

// Stop button
document.getElementById('stop-scan-btn').addEventListener('click', () => stopQrScanner());

// Overlay close button
document.getElementById('close-warning-btn').addEventListener('click', () => hideCameraWarning());

// Auto-retry if user grants permission after closing overlay
navigator.permissions?.query({ name: 'camera' }).then(permissionStatus => {
    permissionStatus.onchange = () => {
        if (permissionStatus.state === 'granted') {
            hideCameraWarning();
            startQrScanner();
        }
    };
});

</script>

<script>
    // HERO CAROUSEL SCRIPT
const track = document.querySelector(".carousel-track");
const slides = Array.from(track.children);
const dotsNav = document.querySelector(".carousel-dots");

let currentIndex = 0;

// Create dots dynamically
slides.forEach((_, index) => {
  const dot = document.createElement("div");
  if (index === 0) dot.classList.add("active");
  dotsNav.appendChild(dot);
});

const dots = Array.from(dotsNav.children);

// Function to move slides
function moveToSlide(index) {
  track.style.transform = `translateX(-${index * 100}%)`;
  dots.forEach(d => d.classList.remove("active"));
  dots[index].classList.add("active");
  currentIndex = index;
}

// Auto slide
setInterval(() => {
  let nextIndex = currentIndex + 1;
  if (nextIndex >= slides.length) nextIndex = 0;
  moveToSlide(nextIndex);
}, 4000);

// Dot click
dots.forEach((dot, index) => {
  dot.addEventListener("click", () => moveToSlide(index));
});

function goTo(page) {
  window.location.href = page;
}

</script>

<script>
function openPage(pageId) {
  document.querySelectorAll(".page").forEach(page => {
    page.classList.remove("active");
  });

  document.getElementById(pageId).classList.add("active");
}

function goBack() {
  document.querySelectorAll(".page").forEach(page => {
    page.classList.remove("active");
  });

  document.getElementById("categoriesPage").classList.add("active");
}
</script>


</body>
</html>
