<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Dashboard | Kulunu</title>
  <link rel="stylesheet" href="style.css" />
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- âœ… Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- Favicons -->
  <link href="assets/img/ku.png" rel="icon">
  <link href="assets/img/ku.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/css/dashboard.css" rel="stylesheet">

<body>
  <div class="dashboard">
    <aside class="sidebar">
      <h2>Kulu</h2>
      <ul>
        <li class="active" onclick="navigate('Profile', this)"><i class="bi bi-person"></i>Profile</li>
        <li onclick="navigate('bookings', this)"><i class="bi bi-airplane"></i>My Bookings</li>
        <li onclick="navigate('payments', this)"><i class="bi bi-credit-card"></i>Payment History</li>
        <li onclick="navigate('logout', this)"><i class="bi bi-box-arrow-right"></i>Logout</li>
      </ul>
    </aside>
    <!-- Main Content -->
    <main class="main-content">
      <!-- Profile Section -->
      <section id="Profile" class="section active">
        <header>
          <h1>Welcome, <span id="username-display"></span> ðŸ‘‹</h1>
          <p>Here is a summary of your travel account.</p>
        </header>
        <button class="book-travel-btn"
          onclick="navigate('bookings', document.querySelector('.sidebar ul li:nth-child(2)'))">
          Book travel
        </button>
        <!-- Profile Card to Display User Details -->
        <div class="d-flex flex-row justify-content-between">
          <div class="profile-card" id="profileDisplay">
            <div class="profile-header">
              <i class="bi bi-person-circle"></i>
              <h2 style="font-size: 25px;">primary Traveler</h2>
              <button class="edit-btn" onclick="openModal(true)">
                Edit
              </button>
            </div>
            <div class="profile-details" id="profileDetails">
              <p>Save information for fast bookings.</p>
            </div>
          </div>


          <!-- Co-travel Card -->
          <div class="co-travel-card">
            <div class="co-travel-header">
              <h2 style="font-size: 25px;">Co-travelers</h2>
            </div>
            <div id="coTravelDetails">
              <p>You have zero <strong>0</strong> other travelers.</p>
              <ul id="coTravelList"></ul>
            </div>
            <button class="co-travel-btn" onclick="openCoTravelModal()">
              <i class="bi bi-person-plus"></i> Add Co-traveler
            </button>
          </div>

          <!-- âœ… Co-travel Modal -->
          <div class="modal" id="coTravelModal">
            <div class="modal-content">
              <h2 id="modalTitle"><i class="bi bi-people"></i>Travel information</h2>
              <form id="coTravelForm" class="grid-form">
                <!-- âœ… Hidden index field for editing -->
                <input type="hidden" id="editIndex" value="-1" />

                <div class="field">
                  <label for="coTitle">Title</label>
                  <select id="coTitle" name="coTitle" required>
                    <option>Mr</option>
                    <option>Mrs</option>
                    <option>Miss</option>
                    <option>Ms</option>
                    <option>Prof</option>
                    <option>Hon</option>
                    <option>Sir</option>
                    <option>Pst</option>
                    <option>Dr</option>
                    <option>Sen</option>
                    <option>Gov</option>
                    <option>Bar</option>
                  </select>
                </div>

                <div class="field">
                  <label for="coTravelerType">Traveler Type</label>
                  <select id="coTravelerType" name="coTravelerType" required>
                    <option>Adult (12y +)</option>
                    <option>Child (2y-12y)</option>
                    <option>Infant (below 2y)</option>
                  </select>
                </div>

                <div class="field">
                  <label for="coFirstName">First Name</label>
                  <input type="text" id="coFirstName" name="coFirstName" required>
                </div>

                <div class="field">
                  <label for="coLastName">Last Name</label>
                  <input type="text" id="coLastName" name="coLastName" required>
                </div>

                <div class="field">
                  <label for="coMiddleName">Middle Name</label>
                  <input type="text" id="coMiddleName" name="coMiddleName">
                </div>

                <div class="field">
                  <label for="coEmail">Email</label>
                  <!-- âœ… changed to type="email" -->
                  <input type="email" id="coEmail" name="coEmail" required>
                </div>

                <div class="field">
                  <label for="coGender">Gender</label>
                  <select id="coGender" name="coGender" required>
                    <option>Male</option>
                    <option>Female</option>
                  </select>
                </div>

                <div class="field">
                  <label for="coRelationship">Relationship</label>
                  <select id="coRelationship" name="coRelationship" required>
                    <option>Spouse</option>
                    <option>Child</option>
                    <option>Sibling</option>
                    <option>Friend</option>
                    <option>Other</option>
                  </select>
                </div>

                <div class="field">
                  <label for="coDob">Date of Birth</label>
                  <input type="date" id="coDob" name="coDob" required>
                </div>

                <div class="field">
                  <!-- âœ… fixed label "for" attribute -->
                  <label for="coPhone">Mobile Number</label>
                  <input type="tel" id="coPhone" name="coPhone" placeholder="+234..." required>
                </div>

                <!-- Actions -->
                <div class="actions">
                  <button type="submit" class="btn primary">Save</button>
                  <button type="button" class="btn ghost" onclick="closeCoTravelModal()">Cancel</button>
                </div>
              </form>
            </div>
          </div>

          <script>
            const coTravelModal = document.getElementById("coTravelModal");
            const coTravelDetails = document.getElementById("coTravelDetails");
            const coTravelList = document.getElementById("coTravelList");
            const modalTitle = document.getElementById("modalTitle");

            let coTravelers = []; // âœ… store travelers globally

            // Open & close modal
            function openCoTravelModal(index = -1) {
              document.getElementById("editIndex").value = index;

              if (index >= 0) {
                // âœ… Prefill form for editing
                const traveler = coTravelers[index];
                document.getElementById("coTitle").value = traveler.title;
                document.getElementById("coTravelerType").value = traveler.travelerType;
                document.getElementById("coFirstName").value = traveler.firstName;
                document.getElementById("coLastName").value = traveler.lastName;
                document.getElementById("coMiddleName").value = traveler.middleName;
                document.getElementById("coEmail").value = traveler.email;
                document.getElementById("coGender").value = traveler.gender;
                document.getElementById("coPhone").value = traveler.phone;
                document.getElementById("coRelationship").value = traveler.relation;
                document.getElementById("coDob").value = traveler.dob;

                modalTitle.innerHTML = `<i class="bi bi-people"></i> Edit Co-traveler`; // âœ… dynamic title
              } else {
                document.getElementById("coTravelForm").reset();
                modalTitle.innerHTML = `<i class="bi bi-people"></i> Add Co-traveler`; // âœ… reset title
              }

              coTravelModal.style.display = "flex";
            }

            function closeCoTravelModal() {
              coTravelModal.style.display = "none";
            }

            // Handle form submit
            document.getElementById("coTravelForm").addEventListener("submit", (e) => {
              e.preventDefault();

              const index = parseInt(document.getElementById("editIndex").value);

              const traveler = {
                title: document.getElementById("coTitle").value,
                travelerType: document.getElementById("coTravelerType").value,
                firstName: document.getElementById("coFirstName").value,
                lastName: document.getElementById("coLastName").value,
                middleName: document.getElementById("coMiddleName").value,
                email: document.getElementById("coEmail").value,
                gender: document.getElementById("coGender").value,
                phone: document.getElementById("coPhone").value,
                relation: document.getElementById("coRelationship").value,
                dob: document.getElementById("coDob").value,
              };

              if (index >= 0) {
                coTravelers[index] = traveler;
              } else {
                coTravelers.push(traveler);
              }

              renderCoTravelers();
              e.target.reset();
              closeCoTravelModal();
            });

            // Render travelers with Edit & Delete
            function renderCoTravelers() {
              coTravelList.innerHTML = "";

              if (coTravelers.length === 0) {
                coTravelDetails.querySelector("p")?.remove();
                const msg = document.createElement("p");
                msg.innerHTML = `You have zero <strong>0</strong> other travelers.`;
                coTravelDetails.insertBefore(msg, coTravelList);
                return;
              } else {
                coTravelDetails.querySelector("p")?.remove();
              }

              coTravelers.forEach((traveler, index) => {
                const li = document.createElement("li");
                li.innerHTML = `
      <strong>${traveler.title} ${traveler.firstName} ${traveler.lastName}</strong> (${traveler.relation}) <br>
      <small>Type: ${traveler.travelerType} | Gender: ${traveler.gender} | Phone: ${traveler.phone}</small><br>
      <small>Email: ${traveler.email} | DOB: ${traveler.dob}</small>
      <div style="margin-top:5px;">
        <span style="color:#0CA6EF;cursor:pointer;" onclick="openCoTravelModal(${index})"><strong>Edit</strong></span>
        &nbsp;|&nbsp;
        <i class="bi bi-trash" style="color:red;cursor:pointer;" onclick="deleteCoTraveler(${index})"></i>
      </div>
    `;
                coTravelList.appendChild(li);
              });
            }

            function deleteCoTraveler(index) {
              if (confirm("Are you sure you want to delete this co-traveler?")) {
                coTravelers.splice(index, 1);
                renderCoTravelers();
              }
            }

            // Close modal if clicked outside
            window.addEventListener("click", (e) => {
              if (e.target === coTravelModal) closeCoTravelModal();
            });
          </script>
      </section>

      <!-- âœ… Modal -->
      <div class="modal" id="profileModal">
        <div class="modal-content">
          <h2><i class="bi bi-person-circle"></i>Travel Information</h2>
          <p>Your travel details will be used for all bookings. Ensure they match your government-issued ID.</p>
          <form id="travelInfoForm" class="grid-form">

            <div class="field">
              <label for="title">Title</label>
              <select id="title" name="title">
                <option>Mr</option>
                <option>Mrs</option>
                <option>Miss</option>
                <option>Ms</option>
                <option>Prof</option>
                <option>Hon</option>
                <option>Sir</option>
                <option>Pst</option>
                <option>Dr</option>
                <option>Sen</option>
                <option>Gov</option>
                <option>Bar</option>
              </select>
            </div>

            <div class="field">
              <label for="travelerType">Traveler Type</label>
              <select id="travelerType" name="travelerType">
                <option value="Adult">Adult(12y +)</option>
                <option value="Child">Child(2y-12y)</option>
                <option value="Infant">Infant(below 2y)</option>
              </select>
            </div>

            <!-- Row 2 -->
            <div class="field">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" name="firstName" required>
            </div>
            <div class="field">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" name="lastName" required>
            </div>

            <!-- Row 3 -->
            <div class="field">
              <label for="middleName">Middle Name</label>
              <input type="text" id="middleName" name="middleName">
            </div>
            <div class="field">
              <label for="gender">Gender</label>
              <select id="gender" name="gender">
                <option>Male</option>
                <option>Female</option>
              </select>
            </div>

            <!-- Row 4 -->
            <div class="field">
              <label for="dob">Date of Birth</label>
              <input type="date" id="dob" name="dob" required>
            </div>
            <div class="field">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" required>
            </div>

            <!-- Row 5 -->
            <div class="field">
              <label for="phone">Mobile Number</label>
              <input type="tel" id="phone" name="phone" placeholder="+234..." required>
            </div>
            <div class="field">
              <label for="nationality">Nationality</label>
              <input type="text" id="nationality" name="nationality" required>
            </div>

            <!-- Row 6 -->
            <div class="field">
              <label for="passportNumber">Passport Number</label>
              <input type="text" id="passportNumber" name="passportNumber" required>
            </div>
            <div class="field">
              <label for="expiryDate">Passport Expiry Date</label>
              <input type="date" id="expiryDate" name="expiryDate" required>
            </div>

            <!-- Actions -->
            <div class="actions">
              <button type="submit" class="btn primary">Save Profile</button>
              <button type="button" class="btn ghost" onclick="closeModal()">Cancel</button>
            </div>
          </form>
        </div>
      </div>


      <script>
        function navigate(sectionId, element) {
          const sections = document.querySelectorAll('.section');
          sections.forEach(sec => sec.classList.remove('active'));
          document.getElementById(sectionId).classList.add('active');

          const navItems = document.querySelectorAll('.sidebar ul li');
          navItems.forEach(item => item.classList.remove('active'));
          element.classList.add('active');
        }

        // âœ… Modal functions
        const modal = document.getElementById("profileModal");

        function openModal() {
          modal.style.display = "flex";
        }
        function closeModal() {
          modal.style.display = "none";
        }

        // Auto open modal after 2 seconds on dashboard load
        window.addEventListener("load", () => {
          setTimeout(() => {
            openModal();
          }, 2000);
        });

        // Handle form submit
        document.getElementById("travelInfoForm").addEventListener("submit", (e) => {
          e.preventDefault();
          const data = {
            title: document.getElementById("title").value,
            travelerType: document.getElementById("travelerType").value,
            firstName: document.getElementById("firstName").value,
            lastName: document.getElementById("lastName").value,
            middleName: document.getElementById("middleName").value,
            gender: document.getElementById("gender").value,
            dob: document.getElementById("dob").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            nationality: document.getElementById("nationality").value,
            passportNumber: document.getElementById("passportNumber").value,
            expiryDate: document.getElementById("expiryDate").value
          };

          // Render into profile card
          const profileDetails = document.getElementById("profileDetails");
          profileDetails.innerHTML = `
        <div class="detail"><strong>Title</strong><span>${data.title}</span></div>
        <div class="detail"><strong>Traveler Type</strong><span>${data.travelerType}</span></div>
        <div class="detail"><strong>First Name</strong><span>${data.firstName}</span></div>
        <div class="detail"><strong>Last Name</strong><span>${data.lastName}</span></div>
        <div class="detail"><strong>Middle Name</strong><span>${data.middleName || '-'}</span></div>
        <div class="detail"><strong>Gender</strong><span>${data.gender}</span></div>
        <div class="detail"><strong>Date of Birth</strong><span>${data.dob}</span></div>
        <div class="detail"><strong>Email</strong><span>${data.email}</span></div>
        <div class="detail"><strong>Mobile</strong><span>${data.phone}</span></div>
        <div class="detail"><strong>Nationality</strong><span>${data.nationality}</span></div>
        <div class="detail"><strong>Passport No.</strong><span>${data.passportNumber}</span></div>
        <div class="detail"><strong>Expiry Date</strong><span>${data.expiryDate}</span></div>
      `;
          closeModal();
        });


        // Close modal on outside click
        window.addEventListener("click", (e) => {
          if (e.target === modal) closeModal();
        });

        // âœ… Edit button pre-fills form with saved profile data
        function openModal(edit = false) {
          if (edit) {
            const details = document.querySelectorAll("#profileDetails p strong");
            if (details.length > 0) {
              // Fill fields only if data exists
              document.getElementById("title").value = details[0].nextSibling.textContent.trim();
              document.getElementById("travelerType").value = details[1].nextSibling.textContent.trim();
              document.getElementById("firstName").value = details[2].nextSibling.textContent.trim();
              document.getElementById("lastName").value = details[3].nextSibling.textContent.trim();
              document.getElementById("middleName").value = details[4].nextSibling.textContent.trim();
              document.getElementById("gender").value = details[5].nextSibling.textContent.trim();
              document.getElementById("dob").value = details[6].nextSibling.textContent.trim();
              document.getElementById("email").value = details[7].nextSibling.textContent.trim();
              document.getElementById("phone").value = details[8].nextSibling.textContent.trim();
              document.getElementById("nationality").value = details[9].nextSibling.textContent.trim();
              document.getElementById("passportNumber").value = details[10].nextSibling.textContent.trim();
              document.getElementById("expiryDate").value = details[11].nextSibling.textContent.trim();
            }
          }
          modal.style.display = "flex";
        }

      </script>

      <section id="bookings" class="section">
        <div class="wrap">
          <h1 class="page-title">My Trips</h1>
          <p class="sub">Find and manage your bookings. Change dates, download invoices, or request a refund.</p>
          <!--- flight search dashboard --->
          <div class="container">
            <div class="search-panel">
              <!-- Trip type selection -->
              <div class="trip-types">
                <label><input type="radio" name="tripType" value="oneway"> One Way</label>
                <label><input type="radio" name="tripType" value="round" checked> Round Trip</label>
                <label><input type="radio" name="tripType" value="multi"> Multicity</label>
              </div>

              <!-- Search fields -->
              <div class="form-grid">
                <div>
                  <label>From</label>
                  <input type="text" id="from" placeholder="Origin">
                </div>
                <div>
                  <label>To</label>
                  <input type="text" id="to" placeholder="Destination">
                </div>
                <div>
                  <label>Date</label>
                  <input type="date" id="date">
                </div>
                <div>
                  <button onclick="window.location.href='Booking.html'">Search</button>
                </div>
              </div>
            </div>
          </div>

          <script>
            const dummyFlights = [
              { airline: 'Airpeace', from: 'Abuja', to: 'Lagos', time: '10:30 AM', price: '$120' },
              { airline: 'Ibom Air', from: 'Abuja', to: 'Lagos', time: '1:00 PM', price: '$110' },
              { airline: 'Flyaero', from: 'Abuja', to: 'Lagos', time: '3:45 PM', price: '$130' }

            ];

            function searchFlights() {
              const from = document.getElementById('from').value;
              const to = document.getElementById('to').value;
              const date = document.getElementById('date').value;
              const resultsContainer = document.getElementById('results');
            }
          </script>

          <!-- Lookup -->
          <section class="card lookup" aria-label="Manage Booking">
            <div class="row">
              <div class="field">
                <label for="bookingId">Booking ID</label>
                <input id="bookingId" placeholder="e.g., WK123ABC" autocomplete="off">
              </div>
              <div class="field">
                <label for="lastName">Last Name</label>
                <input id="lastName" placeholder="e.g., Okafor" autocomplete="off">
              </div>
              <div class="actions" style="align-self:end">
                <button class="btn primary" id="findBtn">Find Booking</button>
                <button class="btn ghost" id="resetBtn" type="button">Reset</button>
              </div>
            </div>
            <div class="tabs" role="tablist" aria-label="Filter trips">
              <button class="tab active" data-filter="upcoming" role="tab" aria-selected="true">Upcoming</button>
              <button class="tab" data-filter="completed" role="tab" aria-selected="false">Completed</button>
              <button class="tab" data-filter="cancelled" role="tab" aria-selected="false">Cancelled</button>
              <button class="tab" data-filter="all" role="tab" aria-selected="false">All</button>
            </div>
            <!-- âœ… Changed ID so it doesn't clash -->
            <div id="booking-results" class="grid" aria-live="polite"></div>
          </section>
        </div>

      </section>
      </section>
      <section id="payments" class="section">
        <h2>Payment History</h2>
        <section class="bookings">
          <div class="booking-entry">
            <p><strong>Lagos â†’ Abuja</strong> | Air Peace | 22 Jul 2025</p>
            <p style="padding-left: 500px; font-size: large;"><strong>â‚¦120,000</strong></p>
            <span class="status confirmed">Confirmed</span>
          </div>
          <div class="booking-entry">
            <p><strong>Abuja â†’ PHC</strong> | Flyaero | 05 Jun 2025</p>
            <p style="padding-left: 500px; font-size: large;"><strong>â‚¦95,000</strong></p>
            <span class="status completed">Completed</span>
          </div>
          <div class="booking-entry">
            <p><strong>Abuja â†’ PHC</strong> | Ibom Air | 05 Jun 2025</p>
            <p style="padding-left: 500px; font-size: large;"><strong>â‚¦110,000</strong></p>
            <span class="status completed">Completed</span>
          </div>
        </section>
      </section>

      <section id="logout" class="section">
        <h2>You have been logged out.</h2>
        <p>Thank you for using Kulunu.</p>
      </section>
    </main>
  </div>

  <script>
    function navigate(sectionId, element) {
      const sections = document.querySelectorAll('.section');
      sections.forEach(sec => sec.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');

      const navItems = document.querySelectorAll('.sidebar ul li');
      navItems.forEach(item => item.classList.remove('active'));
      element.classList.add('active');
    }
  </script>
  <script src="./core/storedUser.js"></script>
  <script src="./core/dashboard.js"></script>
</body>

</html>